<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AIインサイトラボ | ホーム</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css"
    />
    <link rel="stylesheet" href="/style.css" />
  </head>

  <body>
    <header>
      <div class="header-inner">
        <a class="logo" href="index.html">Ren AI Lab</a>
        <nav aria-label="メインナビゲーション">
          <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="categories.html">Categories</a></li>
            <li><a href="archive.html">Archive</a></li>
            <li><a href="profile.html">Profile</a></li>
          </ul>
        </nav>
        <button class="menu-toggle" aria-label="メニューを開閉" aria-expanded="false">
          <i class="fa-solid fa-bars"></i>
        </button>
      </div>

      <div class="mobile-nav" aria-label="モバイルナビゲーション">
        <a href="index.html">Home</a>
        <a href="categories.html">Categories</a>
        <a href="archive.html">Archive</a>
        <a href="profile.html">Profile</a>
      </div>
    </header>

    <main>
      <div class="container">
        <section class="hero">
          <h1>AIとテックの“いま”を、ストレスなくキャッチアップ</h1>
          <p>
            投資・ビジネス・実務活用まで、AI初心者〜中級者のためのナレッジハブ。
            最新ニュースからツール紹介まで、読むべき情報だけを厳選してお届けします。
          </p>
          <div class="hero-actions">
            <a href="#latest" class="button primary">
              <i class="fa-solid fa-tower-broadcast"></i> 最新記事を見る
            </a>
            <a href="categories.html" class="button secondary">
              <i class="fa-solid fa-layer-group"></i> カテゴリから探す
            </a>
          </div>
        </section>

        <section class="insight-panel" aria-labelledby="insight-panel-title">
          <div class="section-header">
            <h2 id="insight-panel-title">Insight Signal</h2>
            <span class="section-subtitle">今日の注目トピックをワンタップで切り替え</span>
          </div>
          <div class="insight-tabs" role="tablist" aria-label="注目テーマ">
            <button class="insight-tab is-active" type="button" data-insight="news" role="tab" aria-selected="true">
              <i class="fa-solid fa-newspaper"></i> ニュース
            </button>
            <button class="insight-tab" type="button" data-insight="tools" role="tab" aria-selected="false">
              <i class="fa-solid fa-wand-magic-sparkles"></i> ツール
            </button>
            <button class="insight-tab" type="button" data-insight="stocks" role="tab" aria-selected="false">
              <i class="fa-solid fa-chart-line"></i> 株・ビジネス
            </button>
          </div>
          <div class="insight-card" data-insight-card>
            <div>
              <p class="insight-label">Focus</p>
              <h3 data-insight-title>速報：業界の新しい動きを把握</h3>
              <p class="insight-text" data-insight-text>
                今日のAIニュースを3分で把握できるよう、重要度の高い話題だけを厳選してお届けします。
              </p>
              <div class="insight-tags" data-insight-tags></div>
            </div>
            <div class="insight-metrics" data-insight-metrics></div>
          </div>
          <div class="insight-footer">
            <a class="button secondary" href="archive.html">
              <i class="fa-solid fa-arrow-right"></i> 注目トピックを深掘り
            </a>
          </div>
        </section>

        <section id="recommended" aria-labelledby="recommended-title">
          <div class="section-header">
            <h2 id="recommended-title">おすすめ記事</h2>
            <a href="archive.html">すべての記事を見る</a>
          </div>
          <div class="card-grid" data-recommended-list>
            <div class="status-text">
              <div class="loader" role="status" aria-label="読み込み中"></div>
            </div>
          </div>
        </section>

        <section aria-labelledby="category-quick-nav">
          <div class="section-header">
            <h2 id="category-quick-nav">カテゴリから探す</h2>
          </div>
          <div class="badge-grid" data-category-shortcuts></div>
        </section>

        <section id="latest" aria-labelledby="latest-title">
          <div class="section-header">
            <h2 id="latest-title">最新記事</h2>
            <a href="archive.html">アーカイブ</a>
          </div>
          <div class="card-grid" data-latest-list>
            <div class="status-text">
              <div class="loader" role="status" aria-label="読み込み中"></div>
            </div>
          </div>
          <div class="status-text" data-latest-status></div>
          <div style="text-align: center; margin-top: 16px;">
            <button class="button secondary" data-load-more>
              <i class="fa-solid fa-plus"></i> もっと見る
            </button>
          </div>
        </section>
      </div>
    </main>

    <footer>
      <div class="footer-inner">
        <div class="footer-links">
          <a href="https://www.instagram.com/ren_web3.0_/" target="_blank" rel="noopener">Instagram</a>
          <a href="https://coconala.com/users/5831852" target="_blank" rel="noopener">ココナラ</a>
          <a href="https://www.threads.com/@ren_web3.0_/" target="_blank" rel="noopener">Threads</a>
        </div>
        <p class="footer-copy">&copy; <span data-current-year></span> AI Insight Lab</p>
      </div>
    </footer>

    <!-- ✅ ここからが「記事復活」に必要 -->
    <script>
      // 年
      document.querySelectorAll("[data-current-year]").forEach((el) => {
        el.textContent = String(new Date().getFullYear());
      });

      // モバイルメニュー
      (function setupMenu() {
        const btn = document.querySelector(".menu-toggle");
        const mobile = document.querySelector(".mobile-nav");
        if (!btn || !mobile) return;

        btn.addEventListener("click", () => {
          const opened = btn.getAttribute("aria-expanded") === "true";
          btn.setAttribute("aria-expanded", String(!opened));
          mobile.style.display = opened ? "none" : "block";
        });
      })();

      // microCMS proxy (/api/posts) から取得して描画
      const CATEGORY_LABEL = {
        "ai-stocks": "AI株情報",
        "ai-intro": "AI使い方入門",
        "ai-tools": "AIツール紹介",
        "ai-news": "AI関連ニュース",
      };

      const INSIGHT_SPOTLIGHT = {
        news: {
          title: "速報：業界の新しい動きを把握",
          text: "今日のAIニュースを3分で把握できるよう、重要度の高い話題だけを厳選してお届けします。",
          tags: ["グローバル動向", "規制・政策", "最新リリース"],
          metrics: [
            { label: "更新頻度", value: "毎日" },
            { label: "所要時間", value: "3分" },
            { label: "注目度", value: "高" },
          ],
        },
        tools: {
          title: "実務で使えるAIツールだけを厳選",
          text: "仕事の生産性を一気に上げるツールを、用途別に評価してスコアリングしています。",
          tags: ["自動化", "ライティング", "分析"],
          metrics: [
            { label: "評価軸", value: "使いやすさ" },
            { label: "導入難易度", value: "低" },
            { label: "ROI", value: "即効型" },
          ],
        },
        stocks: {
          title: "AI投資のトレンドを読み解く",
          text: "成長分野と注目銘柄を俯瞰し、リスクとチャンスをバランス良く整理します。",
          tags: ["半導体", "クラウド", "エンタープライズ"],
          metrics: [
            { label: "視点", value: "中長期" },
            { label: "注目セクター", value: "インフラ" },
            { label: "洞察レベル", value: "戦略的" },
          ],
        },
      };

      function escapeHtml(s) {
        return String(s ?? "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");
      }

      function fmtDate(iso) {
        try {
          return new Date(iso).toLocaleDateString("ja-JP");
        } catch {
          return iso || "";
        }
      }

      function renderInsightCard(key) {
        const card = INSIGHT_SPOTLIGHT[key];
        if (!card) return;
        const titleEl = document.querySelector("[data-insight-title]");
        const textEl = document.querySelector("[data-insight-text]");
        const tagEl = document.querySelector("[data-insight-tags]");
        const metricsEl = document.querySelector("[data-insight-metrics]");
        if (titleEl) titleEl.textContent = card.title;
        if (textEl) textEl.textContent = card.text;
        if (tagEl) {
          tagEl.innerHTML = card.tags
            .map((tag) => `<span class="insight-tag">${escapeHtml(tag)}</span>`)
            .join("");
        }
        if (metricsEl) {
          metricsEl.innerHTML = card.metrics
            .map(
              (metric) => `
                <div class="insight-metric">
                  <p>${escapeHtml(metric.label)}</p>
                  <strong>${escapeHtml(metric.value)}</strong>
                </div>
              `
            )
            .join("");
        }
      }

      (function setupInsightTabs() {
        const tabs = document.querySelectorAll(".insight-tab");
        if (!tabs.length) return;
        tabs.forEach((tab) => {
          tab.addEventListener("click", () => {
            tabs.forEach((btn) => {
              btn.classList.remove("is-active");
              btn.setAttribute("aria-selected", "false");
            });
            tab.classList.add("is-active");
            tab.setAttribute("aria-selected", "true");
            renderInsightCard(tab.dataset.insight);
          });
        });
        renderInsightCard("news");
      })();

      function cardHtml(p) {
        const cat = p.categoryId;
        const catLabel = CATEGORY_LABEL[cat] || cat || "";
        const href = `post.html?id=${encodeURIComponent(p.id)}`;

        return `
          <article class="card">
            <div class="meta">
              ${catLabel ? `<span class="badge"><i class="fa-solid fa-hashtag"></i> ${escapeHtml(catLabel)}</span>` : ""}
              <span><i class="fa-regular fa-calendar"></i> ${escapeHtml(fmtDate(p.publishedAt))}</span>
            </div>

            <a class="title-link" href="${href}">
              ${escapeHtml(p.title || "")}
            </a>

            ${p.eyecatchUrl ? `<img class="thumb" src="${escapeHtml(p.eyecatchUrl)}" alt="" loading="lazy" />` : ""}

            ${p.summary ? `<p class="muted">${escapeHtml(p.summary)}</p>` : ""}
          </article>
        `;
      }

      async function fetchPosts() {
        const r = await fetch("/api/posts", { cache: "no-store" });
        if (!r.ok) throw new Error("Failed to fetch /api/posts");
        const data = await r.json();
        return data.posts || [];
      }

      (async function boot() {
        const recEl = document.querySelector("[data-recommended-list]");
        const latestEl = document.querySelector("[data-latest-list]");
        const catEl = document.querySelector("[data-category-shortcuts]");
        const statusEl = document.querySelector("[data-latest-status]");
        const moreBtn = document.querySelector("[data-load-more]");

        let allPosts = [];
        let shown = 0;
        const PAGE_SIZE = 6;

        function renderRecommended() {
          if (!recEl) return;
          const pick = allPosts.slice(0, 4); // とりあえず先頭4つ
          recEl.innerHTML = pick.length ? pick.map(cardHtml).join("") : `<p class="status-text">記事がありません</p>`;
        }

        function renderCategories() {
          if (!catEl) return;
          const uniq = Array.from(new Set(allPosts.map((p) => (Array.isArray(p.categoryId) ? p.categoryId[0] : p.categoryId)).filter(Boolean)));
          catEl.innerHTML = uniq
            .map((id) => {
              const label = CATEGORY_LABEL[id] || id;
              return `<a class="badge" href="categories.html?category=${encodeURIComponent(id)}">${escapeHtml(label)}</a>`;
            })
            .join("");
        }

        function renderLatest(reset = false) {
          if (!latestEl) return;

          if (reset) {
            shown = 0;
            latestEl.innerHTML = "";
          }

          const next = allPosts.slice(shown, shown + PAGE_SIZE);
          shown += next.length;

          if (reset && next.length === 0) {
            latestEl.innerHTML = `<p class="status-text">記事がありません</p>`;
          } else {
            latestEl.insertAdjacentHTML("beforeend", next.map(cardHtml).join(""));
          }

          if (moreBtn) {
            moreBtn.style.display = shown < allPosts.length ? "inline-flex" : "none";
          }
          if (statusEl) statusEl.textContent = "";
        }

        try {
          allPosts = await fetchPosts();
          renderRecommended();
          renderCategories();
          renderLatest(true);

          if (moreBtn) {
            moreBtn.addEventListener("click", () => renderLatest(false));
          }
        } catch (e) {
          if (recEl) recEl.innerHTML = `<p class="status-text">読み込みに失敗しました</p>`;
          if (latestEl) latestEl.innerHTML = `<p class="status-text">読み込みに失敗しました</p>`;
          if (statusEl) statusEl.textContent = String(e);
        }
      })();
    </script>
  </body>
</html>
