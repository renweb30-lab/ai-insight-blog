<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>記事 | AI Insight Lab</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css"
  />
  <link rel="stylesheet" href="/style.css">

  <!-- 記事本文だけ、追加の見た目を整える（Genspark風） -->
  <style>
    .post-wrap { display: grid; gap: 16px; }
    .post-topbar { display:flex; align-items:center; gap:12px; color: var(--muted, #64748b); }
    .post-topbar a { text-decoration:none; }
    .post-hero {
      padding: 18px 18px;
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,.25);
      background: linear-gradient(180deg, rgba(15,23,42,.75), rgba(15,23,42,.55));
    }
    .post-title { margin: 0; font-size: 24px; letter-spacing: .2px; }
    .post-meta { margin-top: 10px; display:flex; gap:12px; flex-wrap:wrap; color:#94a3b8; font-size: 13px; }
    .post-eyecatch { width:100%; border-radius: 14px; margin-top: 14px; border:1px solid rgba(148,163,184,.25); overflow:hidden; }
    .post-eyecatch img { width:100%; display:block; }
    .post-prose {
      padding: 18px;
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,.25);
      background: rgba(2,6,23,.35);
      line-height: 1.9;
    }
    .post-prose h2 { margin: 18px 0 10px; font-size: 20px; }
    .post-prose h3 { margin: 16px 0 8px; font-size: 16px; color:#e2e8f0; }
    .post-prose p { margin: 10px 0; color:#e2e8f0; }
    .post-prose a { color: #38bdf8; text-decoration: none; }
    .post-prose a:hover { text-decoration: underline; }
    .post-prose ul { margin: 10px 0 10px 22px; }
    .post-prose li { margin: 6px 0; }
    .post-prose hr { border: 0; height: 1px; background: rgba(148,163,184,.25); margin: 18px 0; }
    .post-prose blockquote {
      margin: 14px 0;
      padding: 12px 14px;
      border-left: 3px solid rgba(56,189,248,.8);
      background: rgba(56,189,248,.12);
      border-radius: 12px;
      color:#e2e8f0;
    }
  </style>
</head>

<body>
  <header>
    <div class="header-inner">
      <a class="logo" href="index.html">AI Insight Lab</a>
      <nav aria-label="メインナビゲーション">
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="categories.html">Categories</a></li>
          <li><a href="archive.html">Archive</a></li>
          <li><a href="profile.html">Profile</a></li>
        </ul>
      </nav>
      <button class="menu-toggle" aria-label="メニューを開閉" aria-expanded="false">
        <i class="fa-solid fa-bars"></i>
      </button>
    </div>
    <div class="mobile-nav" aria-label="モバイルナビゲーション">
      <a href="index.html">Home</a>
      <a href="categories.html">Categories</a>
      <a href="archive.html">Archive</a>
      <a href="profile.html">Profile</a>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="post-wrap">
        <div class="post-topbar">
          <a class="button secondary" href="index.html" style="padding:10px 12px;">
            <i class="fa-solid fa-arrow-left"></i> 戻る
          </a>
          <span class="status-text" id="post-status"></span>
        </div>

        <article id="post" class="post-hero" aria-live="polite">
          <div class="status-text">
            <div class="loader" role="status" aria-label="読み込み中"></div>
          </div>
        </article>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-inner">
      <div class="footer-links">
        <a href="https://www.instagram.com/" target="_blank" rel="noopener">Instagram</a>
        <a href="https://coconala.com/" target="_blank" rel="noopener">ココナラ</a>
        <a href="https://www.threads.net/" target="_blank" rel="noopener">Threads</a>
      </div>
      <p class="footer-copy">&copy; <span data-current-year></span>Ren AI Lab</p>
    </div>
  </footer>
  <script>
    async function loadPost(id) {
      const r = await fetch("/api/posts", { cache: "no-store" });
      if (!r.ok) throw new Error("Failed to fetch /api/posts");
      const data = await r.json();
      const posts = data.posts || [];
      return posts.find(p => p.id === id) || null;
    }

    function escapeHtml(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#39;");
    }

    function fmtDate(iso) {
      try {
        return new Date(iso).toLocaleDateString("ja-JP");
      } catch {
        return iso || "";
      }
    }

    (async () => {
      const params = new URLSearchParams(location.search);
      const id = params.get("id");
      const el = document.getElementById("post");
      const status = document.getElementById("post-status");

      if (!id) {
        el.innerHTML = `<p class="status-text">記事IDがありません</p>`;
        return;
      }

      try {
        const p = await loadPost(id);
        if (!p) {
          el.innerHTML = `<p class="status-text">記事が見つかりません</p>`;
          return;
        }

        document.title = `${p.title || "記事"} | AI Insight Lab`;

        el.innerHTML = `
          <h1 class="post-title">${escapeHtml(p.title)}</h1>
          <div class="post-meta">
            <span><i class="fa-regular fa-calendar"></i> ${escapeHtml(fmtDate(p.publishedAt))}</span>
            ${p.categoryId ? `<span><i class="fa-solid fa-hashtag"></i> ${escapeHtml(p.categoryId)}</span>` : ""}
          </div>

          ${p.eyecatchUrl ? `
            <div class="post-eyecatch">
              <img src="${escapeHtml(p.eyecatchUrl)}" alt="" />
            </div>
          ` : ""}

          <div class="post-prose">
            ${p.content ? p.content : "<p>本文がまだ設定されていません</p>"}
          </div>
        `;

        if (status) status.textContent = "";
      } catch (e) {
        el.innerHTML = `<p class="status-text">読み込みに失敗しました</p>`;
        if (status) status.textContent = String(e);
      }
    })();
  </script>
</body>
</html>
