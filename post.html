<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>記事 | AI Insight Lab</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css"
  />
  <link rel="stylesheet" href="/style.css">

</head>

<body>
  <header>
    <div class="header-inner">
      <a class="logo" href="index.html">Ren AI Lab</a>
      <nav aria-label="メインナビゲーション">
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="categories.html">Categories</a></li>
          <li><a href="archive.html">Archive</a></li>
          <li><a href="profile.html">Profile</a></li>
        </ul>
      </nav>
      <button class="menu-toggle" aria-label="メニューを開閉" aria-expanded="false">
        <i class="fa-solid fa-bars"></i>
      </button>
    </div>
    <div class="mobile-nav" aria-label="モバイルナビゲーション">
      <a href="index.html">Home</a>
      <a href="categories.html">Categories</a>
      <a href="archive.html">Archive</a>
      <a href="profile.html">Profile</a>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="post-wrap">
        <div class="post-topbar">
          <a class="button secondary" href="index.html" style="padding:10px 12px;">
            <i class="fa-solid fa-arrow-left"></i> 戻る
          </a>
          <span class="status-text" id="post-status"></span>
        </div>

        <article id="post" class="post-hero" aria-live="polite">
          <div class="status-text">
            <div class="loader" role="status" aria-label="読み込み中"></div>
          </div>
        </article>

        <section class="post-feedback" aria-labelledby="feedback-title">
          <div class="feedback-header">
            <p class="eyebrow">Insight Feedback</p>
            <h2 id="feedback-title">この記事は役に立ちましたか？</h2>
            <p class="feedback-subtitle">いただいた声を次の記事の改善に活かします。</p>
          </div>

          <div>
            <div class="feedback-actions" role="group" aria-label="記事の評価">
              <button class="feedback-button" type="button" data-feedback="helpful">
                <i class="fa-regular fa-face-smile"></i> 役に立った
              </button>
              <button class="feedback-button" type="button" data-feedback="neutral">
                <i class="fa-regular fa-face-meh"></i> ふつう
              </button>
              <button class="feedback-button" type="button" data-feedback="improve">
                <i class="fa-regular fa-face-frown"></i> 改善が必要
              </button>
            </div>

            <div class="feedback-note">
              <label for="feedback-comment">コメント（任意）</label>
              <textarea id="feedback-comment" name="feedback-comment" placeholder="気づいた点や追加してほしいテーマをお聞かせください。"></textarea>
            </div>
          </div>

          <div class="feedback-footer">
            <button class="button primary" id="feedback-submit" type="button">送信する</button>
            <p class="status-text" id="feedback-status" role="status" aria-live="polite"></p>
          </div>
        </section>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-inner">
      <div class="footer-top">
        <div class="footer-brand">
          <a class="footer-logo" href="index.html">Ren AI Lab</a>
          <p class="footer-description">
            AIニュース、ツール、投資インサイトを一つにまとめたビジネス向けナレッジメディア。
            使える視点だけを厳選してお届けします。
          </p>
        </div>
        <div class="footer-grid">
          <div class="footer-column">
            <p class="footer-title">Explore</p>
            <a href="index.html">Home</a>
            <a href="categories.html">Categories</a>
            <a href="archive.html">Archive</a>
            <a href="profile.html">Profile</a>
          </div>
          <div class="footer-column">
            <p class="footer-title">Categories</p>
            <a href="categories.html?category=ai-news">AIニュース</a>
            <a href="categories.html?category=ai-tools">AIツール</a>
            <a href="categories.html?category=ai-stocks">AI株・ビジネス</a>
            <a href="categories.html?category=ai-intro">AI入門</a>
          </div>
          <div class="footer-column">
            <p class="footer-title">Connect</p>
            <a href="https://www.instagram.com/ren_web3.0_/" target="_blank" rel="noopener">Instagram</a>
            <a href="https://coconala.com/users/5831852" target="_blank" rel="noopener">ココナラ</a>
            <a href="https://www.threads.com/@ren_web3.0_/" target="_blank" rel="noopener">Threads</a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p class="footer-copy">&copy; <span data-current-year></span> Ren AI Lab. All rights reserved.</p>
        <p class="footer-note">Empowering teams with practical AI insights.</p>
      </div>
    </div>
  </footer>
  <script>
    async function loadPost(id) {
      const r = await fetch("/api/posts", { cache: "no-store" });
      if (!r.ok) throw new Error("Failed to fetch /api/posts");
      const data = await r.json();
      const posts = data.posts || [];
      return posts.find(p => p.id === id) || null;
    }

    function escapeHtml(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#39;");
    }

    function fmtDate(iso) {
      try {
        return new Date(iso).toLocaleDateString("ja-JP");
      } catch {
        return iso || "";
      }
    }

    (async () => {
      const params = new URLSearchParams(location.search);
      const id = params.get("id");
      const el = document.getElementById("post");
      const status = document.getElementById("post-status");

      if (!id) {
        el.innerHTML = `<p class="status-text">記事IDがありません</p>`;
        return;
      }

      try {
        const p = await loadPost(id);
        if (!p) {
          el.innerHTML = `<p class="status-text">記事が見つかりません</p>`;
          return;
        }

        document.title = `${p.title || "記事"} | AI Insight Lab`;

        el.innerHTML = `
          <h1 class="post-title">${escapeHtml(p.title)}</h1>
          <div class="post-meta">
            <span><i class="fa-regular fa-calendar"></i> ${escapeHtml(fmtDate(p.publishedAt))}</span>
            ${p.categoryId ? `<span><i class="fa-solid fa-hashtag"></i> ${escapeHtml(p.categoryId)}</span>` : ""}
          </div>

          ${p.eyecatchUrl ? `
            <div class="post-eyecatch">
              <img src="${escapeHtml(p.eyecatchUrl)}" alt="" />
            </div>
          ` : ""}

          <div class="post-prose">
            ${p.content ? p.content : "<p>本文がまだ設定されていません</p>"}
          </div>
        `;

        if (status) status.textContent = "";
      } catch (e) {
        el.innerHTML = `<p class="status-text">読み込みに失敗しました</p>`;
        if (status) status.textContent = String(e);
      }
    })();

    (() => {
      const buttons = document.querySelectorAll(".feedback-button");
      const submit = document.getElementById("feedback-submit");
      const comment = document.getElementById("feedback-comment");
      const status = document.getElementById("feedback-status");
      let selected = null;

      const setStatus = (message, isError = false) => {
        if (!status) return;
        status.textContent = message;
        status.style.color = isError ? "#ef4444" : "";
      };

      buttons.forEach((button) => {
        button.addEventListener("click", () => {
          buttons.forEach((b) => b.classList.remove("is-selected"));
          button.classList.add("is-selected");
          selected = button.dataset.feedback || null;
          setStatus("評価を受け付けました。送信ボタンで確定できます。");
        });
      });

      if (submit) {
        submit.addEventListener("click", () => {
          if (!selected) {
            setStatus("評価を選択してください。", true);
            return;
          }
          submit.disabled = true;
          submit.textContent = "送信済み";
          setStatus("フィードバックありがとうございます。");
          if (comment) comment.value = "";
        });
      }
    })();
  </script>
</body>
</html>
